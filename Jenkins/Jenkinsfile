pipeline {
    agent any

    environment {
        REQUIRED_JAVA_VERSION = '11'
        REQUIRED_NODE_VERSION = '14.17.4'
        REQUIRED_GRADLE_VERSION = '7.6.3'
    }

    stages {
        stage('Check Environment') {
            steps {
                echo 'ğŸ” Starting environment validation...'

                sh '''
                    echo "âœ… Checking Git version"
                    git --version || echo "âŒ Git not found"

                    echo "\nâœ… Checking Java version"
                    java -version 2>&1 | head -n 1 || echo "âŒ Java not found"

                    echo "\nâœ… Checking Gradle version"
                    gradle -v | grep Gradle || echo "âŒ Gradle not found"

                    echo "\nâœ… Checking PostgreSQL version"
                    psql --version || echo "âŒ PostgreSQL not found"

                    echo "\nâœ… Checking Redis version"
                    redis-server --version || echo "âŒ Redis not found"

                    echo "\nâœ… Checking Node.js version"
                    node -v || echo "âŒ Node.js not found"

                    echo "\nâœ… Checking npm version"
                    npm -v || echo "âŒ npm not found"

                    echo "\nâœ… Checking Tomcat folder (optional)"
                    [ -d "/opt/tomcat" ] && echo "âœ… Tomcat folder found" || echo "âŒ Tomcat folder not found"
                '''

                echo 'âœ… Environment validation complete.'
            }
        }

        stage('Build Backend') {
            steps {
                echo 'âš™ï¸ Building backend using Gradle'
                sh './gradlew clean build -x test'
            }
        }

        stage('Install Frontend') {
            steps {
                dir('frontend') {
                    echo 'ğŸ“¦ Installing frontend dependencies with npm'
                    sh 'npm install'

                    echo 'ğŸš€ Building frontend'
                    sh 'npm run build'
                }
            }
        }
    }
} 
